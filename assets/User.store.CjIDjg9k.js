import{d as l}from"./ToastAssets.rf4H3wTp.js";const d=typeof window<"u",u="/FrancoVidal",s="cfv-user",e=l(),c=async()=>{const o=JSON.parse(localStorage.getItem(s)||"{}")?.tiktok,r=e.get()?.tiktok,t=Date.now();if(o?.credentials?.expire_at&&o.credentials.expire_at>t)return console.log("âœ… [dev] using credentials from cache before fetching "),e.setKey("tiktok.credentials",o.credentials),{user:e.get(),isValid:!0};if(r?.credentials?.expire_at&&t>r.credentials.expire_at)try{const n=await(await fetch(`https://app-mroiudgeuq-uc.a.run.app/oauth/refresh?uid=${r.info.uid}`)).json();return e.setKey("tiktok.credentials",n.credentials),{user:e.get(),isValid:!0}}catch(a){return console.error("âŒ Failed to refresh token:",a),{user:e.get(),isValid:!1}}return{user:e.get(),isValid:!0}};d&&(async()=>{console.log("ðŸŒ Inicializando usuario...");const o=localStorage.getItem(s),r=JSON.parse(o||"{}")?.tiktok,{info:t,credentials:a}=r||{};if(!t?.open_id||!t?.username||!t?.role){localStorage.removeItem(s),window.location.href=`${u}/auth/login`;return}if(a?.expire_at)e.setKey("tiktok",{info:t,credentials:a}),console.log("âœ… [dev] User loaded from localStorage"),await c();else{const i=await(await fetch(`https://app-mroiudgeuq-uc.a.run.app/oauth/credentials?uid=${t.open_id}`)).json();e.setKey("tiktok",i),localStorage.setItem(s,JSON.stringify({tiktok:{info:i.info,credentials:i.credentials}}))}})();const g=()=>{localStorage.removeItem(s),window.location.reload()},p={logOut:g,validateToken:c,get:()=>e.get()};export{e as $,p as U};
