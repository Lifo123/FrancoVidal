import{r as o}from"./index.DuP_GS2H.js";let r=[],f=0;const a=4;let p=u=>{let t=[],e={get(){return e.lc||e.listen(()=>{})(),e.value},lc:0,listen(l){return e.lc=t.push(l),()=>{for(let i=f+a;i<r.length;)r[i]===l?r.splice(i,a):i+=a;let n=t.indexOf(l);~n&&(t.splice(n,1),--e.lc||e.off())}},notify(l,n){let i=!r.length;for(let s of t)r.push(s,e.value,l,n);if(i){for(f=0;f<r.length;f+=a)r[f](r[f+1],r[f+2],r[f+3]);r.length=0}},off(){},set(l){let n=e.value;n!==l&&(e.value=l,e.notify(n))},subscribe(l){let n=e.listen(l);return l(e.value),n},value:u};return e};function v(u,t,e){let l=new Set([...t,void 0]);return u.listen((n,i,s)=>{l.has(s)&&e(n,i,s)})}let m=(u={})=>{let t=p(u);return t.setKey=function(e,l){let n=t.value;typeof l>"u"&&e in t.value?(t.value={...t.value},delete t.value[e],t.notify(n,e)):t.value[e]!==l&&(t.value={...t.value,[e]:l},t.notify(n,e))},t},c=(u,t)=>e=>{u.current=e,t()};function E(u,{keys:t,deps:e=[u,t]}={}){let l=o.useRef();l.current=u.get();let n=o.useCallback(s=>t?.length>0?v(u,t,c(l,s)):u.listen(c(l,s)),e),i=()=>l.current;return o.useSyncExternalStore(n,i,i)}export{p as a,m,E as u};
