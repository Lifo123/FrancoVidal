import{j as e}from"./jsx-runtime.D3GSbgeI.js";import{T as g,u as j,d as y,a as b}from"./ToastAssets.rf4H3wTp.js";import{R as u}from"./index.DuP_GS2H.js";import{$ as w,U as k}from"./User.store.CjIDjg9k.js";import{B as p}from"./ButtonPromise.BgODO_JZ.js";import{U as d}from"./index.D6q6NUg2.js";import"./index.yBjzXJbu.js";function _({children:s,className:t,style:o}){return e.jsx("div",{className:t||"f-row f-align-center g-2 tab-list",style:o,children:s})}function x(s){const{select:t,setSelect:o,customize:i}=u.useContext(g),a=t===s.id,n="tab-item d-flex btn-fourth br-8 pointer fs-2 o-hidden",l=a?i?.activeItem?.className||s.className||`${n} active-tab`:s.className||n,r=a&&i?.activeItem?.style||s.style;return e.jsx("span",{className:n+` ${a?l:""}`,onClick:()=>o(s.id),style:r,children:s.custom||e.jsx("span",{className:"p-2",children:s.text||s.id})})}function h(s){const{select:t,customize:o}=u.useContext(g);return t!==s.id?null:e.jsx("div",{className:o?.content?.className||"tab-content p-3 f-col h-100 w-100 br-10 o-auto",style:o?.content?.style,children:s.children||`Contenido para ${s.id}`})}function C(){const s=j(w)?.tiktok,t=u.useRef(null),o=a=>{const n=a.match(/video\/(\d+)/);return n?n[1]:null},i=async a=>{const n=o(a);if(!n){d.toast.error("URL inválida.");return}const{isValid:l}=await k.validateToken();if(!l)return;const r=await fetch(`https://app-mroiudgeuq-uc.a.run.app/videos/?uid=${s?.info?.open_id}&access_token=${s?.credentials?.access_token}&save=true&vid=${n}`),c=await r.json();if(!r.ok){d.toast.error("Error al enviar el video.");return}d.toast.show(c.msg),t.current.value=""};return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"https://www.tiktok.com/@username/video/xxxxxxxxxxxxxxxxx",className:"f-grow",ref:t}),e.jsx(p,{text:"Enviar",onClick:async()=>{if(t.current){if(!t.current.value){d.toast.error("URL no puede estar vacía");return}await i(t.current.value)}}})]})}const R=async(s,t)=>{const{isValid:o,user:i}=await k.validateToken();if(!o||!i?.tiktok?.credentials?.access_token)return console.warn("⛔ Token inválido o no disponible."),{msg:"Sesión inválida",videos:[]};const a=["id","create_time","cover_image_url","share_url","video_description","duration","height","width","title","embed_link","like_count","comment_count","share_count","view_count"].join(",");try{if(s){const n=s.split(",").map(c=>c.trim()).filter((c,f,N)=>c&&N.indexOf(c)===f);if(!n.length)return{msg:"IDs inválidos",videos:[]};const r=await(await fetch(`https://open.tiktokapis.com/v2/video/query/?fields=${a}`,{method:"POST",headers:{Authorization:`Bearer ${i.tiktok.credentials.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({filters:{video_ids:n}})})).json();return r.data?.videos?.length?{msg:"Videos encontrados",videos:r.data.videos}:{msg:"No se encontraron videos con esos IDs",videos:[]}}else{const n=new URL("https://open.tiktokapis.com/v2/video/list/");n.searchParams.set("fields",a),t&&n.searchParams.set("cursor",t);const l=await fetch(n.href,{method:"POST",headers:{Authorization:`Bearer ${i.tiktok.credentials.access_token}`,"Content-Type":"application/json"}});if(!l.ok){const f=await l.text();return console.error("❌ API error response:",f),{msg:"Error al cargar los videos",videos:[]}}const r=await l.json(),c=r?.data?.videos||[];return{msg:c.length?"Videos cargados":"No hay videos en la cuenta",videos:c,cursor:r?.data?.cursor||null,hasMore:r?.data?.has_more||!1}}}catch(n){return console.error("❌ Error al obtener videos:",n),{msg:"Error inesperado",videos:[]}}},T={getVideos:R},I={like:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsxs("g",{children:[e.jsx("g",{children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.5 2.25C10.5 2.25 12 4.25 12 4.25C12 4.25 13.5 2.25 16.5 2.25C20 2.25 22.5 4.99999 22.5 8.5C22.5 12.5 19.2311 16.0657 16.25 18.75C14.4095 20.4072 13 21.5 12 21.5C11 21.5 9.55051 20.3989 7.75 18.75C4.81949 16.0662 1.5 12.5 1.5 8.5C1.5 4.99999 4 2.25 7.5 2.25Z"})}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.40179 12.1998C3.58902 14.6966 5.7592 16.9269 7.74989 18.75C9.5504 20.3989 10.9999 21.5 11.9999 21.5C12.9999 21.5 14.4094 20.4072 16.2499 18.75C19.231 16.0657 22.4999 12.5 22.4999 8.49997C22.4999 8.41258 22.4983 8.32566 22.4952 8.23923C20.5671 13.6619 13.6787 18.5 11.75 18.5C10.3127 18.5 5.61087 15.8131 2.40179 12.1998Z",fillOpacity:"0.03"})]})," "]}),comment:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.5 2 2 6.5 2 12c0 2.3.8 4.5 2.3 6.3l-2 2c-.4.4-.4 1 0 1.4.2.2.4.3.7.3h9c5.5 0 10-4.5 10-10S17.5 2 12 2zM8 13c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm4 0c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm4 0c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"})}),share:e.jsx("svg",{viewBox:"0 0 512 512",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M512 230.431 283.498 44.621v94.807C60.776 141.244-21.842 307.324 4.826 467.379c48.696-99.493 149.915-138.677 278.672-143.14v92.003L512 230.431z"})}),view:e.jsx("svg",{viewBox:"0 0 48 48",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 10.554V37.4459L38.1463 24L16 10.554ZM12 8.77702C12 6.43812 14.5577 4.99881 16.5569 6.21266L41.6301 21.4356C43.5542 22.6038 43.5542 25.3962 41.6301 26.5644L16.5569 41.7873C14.5577 43.0012 12 41.5619 12 39.223V8.77702Z"})})};function m({icon:s="like",size:t=24,...o}){const i=I[s||"like"];return i?e.jsx("span",{className:`tiktok-icon ${o.className||""}`,style:{height:t,width:t,...o.style},children:i}):null}function L(){return e.jsxs("div",{className:"revisar-video-detail f-col g-2 mb-2 select",children:[e.jsx("span",{className:"fs-2",children:"Subir URL del video"}),e.jsx("div",{className:"f-row f-justify-between f-align-center f-grow g-6",children:e.jsx(C,{})})]})}function V({USER:s,...t}){const o=async()=>{new Promise(i=>setTimeout(i,500)),t.role==="user"?d.Dialog.custom(e.jsx(L,{}),{animate:{start:{top:"5rem",left:"5rem"},end:{top:"0rem",left:"0rem"}}}):d.Dialog.show({title:"Importante",message:`Enviar a revision cuando llegue a ${t.id}`,onClick:async()=>{await new Promise(i=>setTimeout(i,500)),d.Dialog.hide(),await o()}})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"video-detail-row f-row f-justify-between g-2 px-4 py-3 br-8 mb-1",children:[e.jsxs("div",{className:"f-row g-4 fs-2 f-nowrap f-align-center",children:[s?.role==="user"&&e.jsx("div",{children:e.jsx("span",{className:"d-flex f-center br-50 o-hidden",children:e.jsx("img",{height:30,width:30,src:s?.avatar_url_100,alt:s?.username})})}),e.jsxs("div",{className:"video-detail-desc f-col fs-custom-13-5 g-1",children:[t.title&&e.jsx("span",{className:"fs-custom-15",children:t.title}),e.jsx("span",{children:t.video_description?.trim()||"No hay descripción."})]})]}),e.jsxs("div",{className:"f-row g-5 fs-2 f-center",children:[e.jsxs("span",{className:"f-col g-1 f-center no-select ",children:[e.jsx(m,{icon:"view",size:23}),e.jsx("span",{className:"fs-1 fw-600 mt-1",children:t.view_count||0})]}),e.jsxs("span",{className:"f-col g-1 f-center no-select ",children:[e.jsx(m,{icon:"like",size:23}),e.jsx("span",{className:"fs-1 fw-600 mt-1",children:t.like_count||0})]}),e.jsxs("span",{className:"f-col g-1 f-center no-select ",children:[e.jsx(m,{icon:"comment",size:23}),e.jsx("span",{className:"fs-1 fw-600 mt-1",children:t.comment_count||0})]}),e.jsxs("span",{className:"f-col g-1 f-center no-select ",children:[e.jsx(m,{icon:"share",size:23}),e.jsx("span",{className:"fs-1 fw-600 mt-1",children:t.share_count||0})]}),e.jsx(p,{className:"tt-primary br-4 fs-custom-15 btn",loadingId:t.id,text:t.role!=="user"?"Enviar":"Detalles",stroke:"#FFF",onClick:async()=>{await o()}})]})]})})}const $=typeof window<"u",v=y([]);$&&(async()=>console.log("wadawdaw"))();function z(s){const[t,o]=u.useState(!1),i=j(v);return u.useEffect(()=>{T.getVideos().then(a=>a.videos).then(a=>{v.set(a),console.log(v.get())})},[]),e.jsx(e.Fragment,{children:i.length!==0?i.map(a=>e.jsx(V,{role:s?.role,...a,USER:s},a.id)):"Cargando..."})}function P(){const s=j(w)?.tiktok?.info;return e.jsx(e.Fragment,{children:e.jsxs(b,{default:"1",customize:{content:{className:"mt-3 f-col g-2"}},children:[e.jsxs(_,{children:[e.jsx(x,{id:"1",text:"Enviar link"}),e.jsx(x,{id:"2",text:"En revision"}),e.jsx(x,{id:"3",text:"Mis videos"})]}),e.jsx(h,{id:"1",children:e.jsxs("section",{className:"f-col g-2 mb-2",children:[e.jsx("span",{className:"fs-2",children:"Obtener video mediante URL"}),e.jsx("div",{className:"f-row f-justify-between f-align-center f-grow g-6",children:e.jsx(C,{})})]})}),e.jsx(h,{id:"2"}),e.jsx(h,{id:"3",children:e.jsx(z,{USER:s})})]})})}export{P as default};
