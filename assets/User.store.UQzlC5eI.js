import{d as l}from"./ToastAssets.BztuLOLW.js";const d=typeof window<"u",u="/FrancoVidal",a="cfv-user",e=l(),c=async()=>{const r=JSON.parse(localStorage.getItem(a)||"{}")?.tiktok,o=e.get()?.tiktok,t=Date.now();if(r?.credentials?.expire_at&&r.credentials.expire_at>t)return console.log("âœ… [dev] using credentials from cache before fetching "),e.setKey("tiktok.credentials",r.credentials),{user:e.get(),isValid:!0};if(o?.credentials?.expire_at&&t>o.credentials.expire_at)try{const i=await(await fetch(`https://app-mroiudgeuq-uc.a.run.app/oauth/refresh?uid=${o.info.uid}`)).json();return e.setKey("tiktok.credentials",i.credentials),{user:e.get(),isValid:!0}}catch(s){return console.error("âŒ Failed to refresh token:",s),{user:e.get(),isValid:!1}}return{user:e.get(),isValid:!0}};d&&(async()=>{console.log("ðŸŒ Inicializando usuario...");const r=localStorage.getItem(a),o=JSON.parse(r||"{}")?.tiktok,t=o?.info,s=o?.credentials;if(!t?.open_id||!t?.username||!t?.role){localStorage.removeItem(a),window.location.href=`${u}/auth/login`;return}if(s?.expire_at)e.setKey("tiktok",{info:t,credentials:s}),console.log("âœ… [dev] User loaded from localStorage"),await c();else{const n=await(await fetch(`https://app-mroiudgeuq-uc.a.run.app/oauth/credentials?uid=${t.open_id}`)).json();e.setKey("tiktok",n),localStorage.setItem(a,JSON.stringify({tiktok:{baseLocalKey:a,info:n.info}}))}})();const f=()=>{localStorage.removeItem(a),window.location.reload()},p={logOut:f,validateToken:c,get:()=>e.get()};export{e as $,p as U};
